# 前言

说实话，感觉安全工程师面试比开发会轻松很多，也不知道是实习的原因还是什么原因，没有那么拷打。上来就是自我介绍，然后针对自我介绍进行了一个询问，然后就是一个场景题从头到尾。

# 开源项目介绍

问：介绍一下你最感兴趣的一个开源项目吧，然后说一下它的亮点。

答：讲了最近学的 Redis 语言

# 场景题

1.   设计一个运行在主机上的`dns`过滤器，假设当前有一个`5000w`的域名，设计一下技术方案，包括怎么拦截，数据结构，计算等等。假设`1%`的泛域名，`99%`的单域名

     >   使用布隆过滤器+前缀树，更新使用增量更新的方式，而不是全量更新。问题在于，布隆过滤器不适合增量更新。

2.   布隆过滤器在哈希碰撞可能出现的业务场景是什么？（PS：这里我有点紧张了）

     >   有可能一个域名不在白名单里面，但是布隆过滤器检查它的所有映射发现在布隆过滤器里面，这导致误判问题（业务叫做：误拦截）

3.   `5000w`的中的单域名有`4950w`，泛域名有`50w`。单域名使用前缀树是非常大的，假设单域名就是使用布隆过滤器，那么现在讲讲对于泛域名怎么检测。假设允许`1%`的漏拦截。

     >   前缀树，但是对于前缀树中节点的检测模式使用布隆过滤器。

4.   泛域名不多，其实直接使用前缀树即可，没必要用布隆过滤器。

     >   我一开始没有考虑到50w是比较低的数量级

5.   上述的问题只涉及到匹配算法，假设单域名使用布隆过滤器匹配，泛域名使用前缀树或者字典树。那么讲讲怎么去拦截流量呢？

     >   第一想法是 `tun` 网卡来实现，然后设置流量

6.   虚拟网卡涉及到引流规则，我们只需要拦截`DNS`协议，对于其他流量不想管，那么怎么实现呢？或者说怎么只监听53端口流量呢？

     >   只监听53端口流量，使用 `wireshark` 啥的，只抓取 `53` 端口

7.   这里只是考虑系统机制，`wireshark`是一个旁路由的方式，这个只涉及到一个考核点，再想想有没有其他机制只监听53端口

     >   暂时想不到，如果说能直接把`UDP 53`端口流量直接转发

8.   假设这个方式实现了，协议层面怎么处理，你看到的包是`IP`包

     >   利用`IP`头部字段+`UDP`的端口字段

9.   那就是一层一层解包是吧。现在聊到数据怎么更新，你提到增量更新。说说具体实施方案，要求原则有：不能有中间状态，即所有的规则只能同时生效或者同时不生效；业务不能停，即更新期间，不能中止业务。

     >   创建一个副本，然后使用指针来切换，就可以达到瞬间更新。

10.   这样切换有什么问题，会造成什么风险

      >   那肯定是需要上锁，会造成非常短暂的卡顿

11.   这个其实无所谓，具体切换的时候用什么锁机制

      >   要求前缀树和布隆过滤器同时切换，这怎么解决

12.   两个都准备好，然后同时切换。能不能用无锁机制（PS： 这里我之前有个误解，以为无锁的要求指的是不能使用锁+原子变量，然后就巴拉巴拉乱回答了）

      >   标注开始时间和结束时间，检测的时候就需要考虑是不是过期了。

13.   跟之前的方案不一样，重新换个方式提问。如何使用无锁进行切换单个指针，或者说无锁对单个指针进行赋值。

      >   对指针设置过期时间

14.   还是想的太复杂了，但是过期了时候，数据还没有构造好怎么办？这会导致一段时间停止，说说一个指针怎么无所操作，切换一个指针是不是线程安全，C++怎么安全更新一个64位的值

      >   不是的，其他都是读操作，这个是一个写操作。那就是使用原子操作。

15.   假设已经成功实现了一个锁的线程安全切换（PS： 这里我才完全明白，原子操作也是一种不加锁操作）。怎么切换两个指针呢？

      >   开辟一块空间存储两个指针，一个是布隆过滤器的地址，一个是前缀树的地址，使用一个指针指向这个空间，然后对这个指针进行原子操作。二级指针

16.   假如使用上述方案，程序上线了，但是发现`100w`台机器，只有`3-5`台机器发生死锁，应该怎么去定位问题呢？假如有`root`权限等

      >   回答了什么查看`cpu`占用等等，然后面试官说说这是猜测问题，希望直接定位到代码哪行。面试官说，使用`GDB`调试。怎么去调试远程程序呢？但是这个我没用过，就回答不知道。还问了，GDB调试第一步是什么，我说是编译一个`DEBUG`版本，但是其实问的是远程调试

17.   假如已经使用`GDB`远程调试，`attack`上去了。因为不能重启或者杀死那个线程，这会导致`bug`复现失败。应该查看什么信息来调试呢？

      >答，先查看所有线程，然后查看每个线程的调用栈，然后根据调用栈来看，是哪个线程在占据着锁。



# 其他

1.   愿意做什么方向的

     >   C++开发，或者其他语言都是可以的。想做一些安全开发方向，比如一个安全软件的开发，类似于防火墙的东西。

2.   做过哪些接近于真实产品的项目或者程序

     >   做过一个，但是不是写代码做的，是利用软硬件拼接起来。答案是单线多拨

3.   工作城市有什么意愿

     >   江浙沪+广州

4.   阿里是杭州的，北京考虑吗，然后问了家在哪

     >   稍微讲了讲工作城市

# 反问

1.   比如刚刚讲的产品是贵部门的，还是希望了解一下更多的产品，或者说类似于市面的一些什么产品

     >   主要是反入侵和反泄露。反泄露就是防止阿里内部的数据被泄露出去，通过图片、WEB流量、纸质打印等等方面。比如一个文件，经过了`base64`，然后经过压缩，然后加密等等，怎么检测这个是敏感数据，并对它进行过滤。反入侵就是比如怎么对抗病毒，比如内网一个用户，点击了一个网站，然后自动下载了一个病毒，病毒通过了定时任务活了。这一这个过程怎么检测，怎么溯源等等。

2.   是不是类似于安全网关

     >   只是`零信任`那一块是安全网关

3.   实习生培养流程

     >   一方面是做一些不急于交付的小任务，跟产品相关的，或者调研技术路径实施可行性等。一些周边设施

4.   周边设施是指为其他公司或者部门进行安全服务吗？

     >   不是，是为本部门`信息安全团队`服务的，比如前面说的`ping-pong`检测。

5.   实习面试后续流程

     >   还有一个`hr`或者再往上一层的老板面试，这一面过了之后就是蛮简单的

6.   对于入职这一段时间，学习方向什么推荐？

     >   了解一些该方向的生态产品，多看一些安全相关的开源工程，如以下：
     >
     >   -   [osquery](https://www.osquery.io/)
     >
     >       >   由 Facebook 开源的一款跨平台操作系统检测、监控和分析框架。它将操作系统视为一个高性能关系型数据库，通过 SQL 查询语言，用户可以轻松检索和分析系统信息，如进程、文件系统、网络连接等。osquery 支持 Linux、macOS、Windows 等主流操作系统，具备实时监控系统状态变化、记录事件等功能，广泛应用于系统管理、安全监控、事件调查及合规性检查等场景。其强大的扩展性也使其能够满足更多定制化需求。
     >
     >   -   [nushell](https://www.nushell.sh/zh-CN/book/)
     >
     >       >   Nushell（简称 Nu）是一个现代化的跨平台 Shell 工具，旨在通过结构化数据处理和强大的管道功能，为用户提供更高效、更友好的命令行体验。它支持在 Linux、macOS、Windows 等多种操作系统上运行，能够将命令输出以表格形式展示，并通过管道将数据以结构化形式传递，实现复杂任务的轻松组合。Nushell 还具备语法高亮、自动补全、错误提示等现代特性，适合数据科学家、自动化任务开发者以及跨平台用户，帮助他们在不同系统上使用统一的工具和脚本，提升工作效率和协作便利性。
     >
     >   -   [velociraptor](https://docs.velociraptor.app/)
     >
     >       >   Velociraptor 是一款开源的数字取证与事件响应（DFIR）工具，专为高效收集、分析终端数据而设计。它支持跨平台操作，能够快速扫描 Windows、Linux 和 macOS 系统，获取文件系统、注册表、网络连接等关键信息。其核心优势在于灵活的 Velocidex Query Language（VQL）查询语言，用户可通过编写 VQL 语句实现高度定制化的数据检索与分析。此外，Velociraptor 还具备实时监控、自动响应威胁以及威胁狩猎功能，可广泛应用于事件响应、威胁狩猎、数据泄露调查及持续监控等场景，帮助安全团队快速发现并应对潜在威胁。
     >
     >   -   [Cobal Strike](https://www.cobaltstrike.com/)
     >
     >       >   Cobalt Strike 是一款功能强大的商业渗透测试工具，广泛应用于网络安全领域。它采用 C/S 架构，包含客户端和服务端，支持生成多种格式的攻击载荷，并具备钓鱼攻击、横向移动、权限提升等功能。其核心组件 Beacon 可实现隐蔽的 C2 通信和长期控制目标主机。此外，Cobalt Strike 还支持团队协作，便于多人协同作战，是红队行动和渗透测试中不可或缺的工具。但需注意，该工具仅可用于合法的网络安全评估，严禁用于非法攻击。
     >
     >   -   [open Source Endpoint Detection and Response, Open EDR](https://www.openedr.com/)
     >
     >       >   OpenEDR 是一个开源的端点检测与响应（EDR）平台，由网络安全公司 Comodo 发起并维护。它通过实时监控和分析系统活动，提供全面的威胁检测与自动响应功能，能够快速识别并隔离恶意行为，有效保护端点安全。OpenEDR 集成了 MITRE ATT&CK 框架，支持多操作系统部署，并且完全免费，适合各种规模的组织使用。其开源特性也鼓励社区参与，进一步提升其功能和安全性。
     >
     >   -   [Chromium](https://www.chromium.org/chromium-projects/)
     >
     >       >   推荐学一下它的代码风格等等